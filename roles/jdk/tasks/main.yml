- name: copy jdk
  copy:
    src: "files/{{jdk_repo_file}}"
    dest: "{{apps_dir}}/{{jdk_repo_file}}"
  register: copyJdk

- name: create jdk directories
  file:
    path: "{{ jdk_install_dir }}"
    state: directory
    owner: "{{ username }}"

- name: extract jdk
  unarchive:
    src: "{{ apps_dir }}/{{ jdk_repo_file }}"
    dest: "{{ jdk_install_dir }}/"
    remote_src: yes
    extra_opts:
      - --strip-components=1
  when: copyJdk.changed

- name: make sure /etc/profile.d exists
  become: True
  file: 
    path: /etc/profile.d  
    state: directory

- name: export JAVA_HOME
  become: True
  template:
    src:  ../templates/java_home.sh.j2
    dest: /etc/profile.d/java_home.sh
    mode: "a+x"
  register: copy_java_home

- name: sourcing/activating configuration
  shell: "source /etc/profile.d/java_home.sh"
  when: copy_java_home.changed